<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no,minimal-ui">
        <title>菩提阁</title>
        <link rel="icon" href="./../images/favico.ico">
        <!--不同屏幕尺寸根字体设置-->
        <script src="./../js/base.js"></script>
        <!--element-ui的样式-->
        <link rel="stylesheet" href="../../backend/plugins/element-ui/index.css" />
        <!--引入vant样式-->
        <link rel="stylesheet" href="../styles/vant.min.css"/>
        <!-- 引入样式  -->
        <link rel="stylesheet" href="../styles/index.css" />
        <!--本页面内容的样式-->
        <link rel="stylesheet" href="./../styles/address-edit.css" />
    </head>
    <body>
        <div id="address_edit" class="app">
            <div class="divHead">
                <div class="divTitle">
                    <i class="el-icon-arrow-left" @click="goBack"></i>{{title}}
                </div>
            </div>
            <div class="divContent">
                <div class="divItem">
                   <span>学生姓名：</span>
                   <el-input placeholder=" 请填写学生的姓名" v-model="form.studentName"  maxlength='10' class="inputUser"/></el-input>
                </div>
                <div class="divItem">
                    <span>家长姓名：</span>
                    <el-input placeholder=" 请填写家长的姓名" v-model="form.parentName"  maxlength='10' class="inputUser"/></el-input>
                </div>

                <div class="divItem">
                    <span>手机号：</span> 
                    <el-input placeholder=" 请填写家长的手机号码" v-model="form.phone"  maxlength='20' style="width: calc(100% - 80rem);"/></el-input>
                </div>
                <div class="divItem">
                    <span>年级：</span>
                    <el-input placeholder=" 请填写学生的年级" v-model="form.grade"  maxlength='10' class="inputUser"/></el-input>
                </div>
                <div class="divSave" @click="saveAddress">保存信息</div>
            </div>
        </div>
        <!-- 开发环境版本,包含了有帮助的命令行警告 -->
        <script src="../../backend/plugins/vue/vue.js"></script>
        <!-- 引入组件库 -->
        <script src="../../backend/plugins/element-ui/index.js"></script>
        <!-- 引入vant样式 -->
        <script src="./../js/vant.min.js"></script>       
        <script src="./../js/common.js"></script>
        <script src="./../api/address.js"></script>
        <script src="./../api/student.js"></script>
        <!-- 引入axios -->
        <script src="../../backend/plugins/axios/axios.min.js"></script>
        <script src="./../js/request.js"></script>
        <script>
            new Vue({
                el:"#address_edit",
                data(){
                    return {
                        title:'编辑个人信息',
                        form:{
                            studentName:'',
                            parentName:'',
                            phone:'',
                            grade: ''
                        },
                        id:undefined,
                        activeIndex :0
                    }
                },
                computed:{},
                created(){
                    this.initData()
                },
                mounted(){
                },
                methods:{
                    goBack(){
                        history.go(-1)
                    },
                    async initData(){
                        const params = parseUrl(window.location.search)
                        this.id = params.id
                        if(params.id){
                            this.title = '编辑个人信息'
                            const res = await queryStudentByIdAPI(params.id)
                            if(res.code === 1){
                                this.form = res.data
                            }else{
                                this.$notify({ type:'warning', message:res.msg});
                            }
                        }
                    },
                    async saveAddress(){
                        const form = this.form

                        if (!form.studentName) {
                            this.$notify({ type:'warning', message:'请输入学生姓名'});
                            return
                        }
                        if (!form.parentName) {
                            this.$notify({ type:'warning', message:'请输入家长姓名'});
                            return
                        }
                        if (!form.phone) {
                            this.$notify({ type:'warning', message:'请输入手机号码'});
                            return
                        }
                        if (!form.grade) {
                            this.$notify({ type:'warning', message:'请输入年级'});
                            return
                        }
                        const reg = /^1(3[0-9]|4[57]|5[0-35-9]|6[6]|7[0135678]|8[0-9]|9[89])\d{8}$/
                        if(!reg.test(form.phone)){
                            this.$notify({ type:'warning', message:'手机号码不合法'});
                            return  
                        }
                        let res= {}
                        if(this.id){
                            res = await updateAPI(this.form)
                        }else{
                            res = await addAddressApi(this.form)
                        }
                        
                        if(res.code === 1){
                            window.requestAnimationFrame(()=>{
                                window.location.replace('/front/page/user.html')
                            })
                        }else{
                            this.$notify({ type:'warning', message:res.msg});
                        }
                    }
                }
            })
            </script>
    </body>
</html>
